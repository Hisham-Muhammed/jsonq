<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament Stats Master - Fixed</title>
    <style>
        :root {
            --primary: #0f172a; --secondary: #3b82f6; --accent: #10b981; --danger: #ef4444; --bg: #f8fafc;
        }
        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #1e293b; font-size: 13px; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 15px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        
        .match-setup { display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 10px; margin-bottom: 15px; background: #fff; border: 1px solid #e2e8f0; padding: 10px; border-radius: 12px; }
        .team-cfg input { padding: 8px; font-weight: 800; border: 2px solid #cbd5e1; border-radius: 8px; text-align: center; text-transform: uppercase; width: 100%; box-sizing: border-box; }
        .vs-badge { background: var(--primary); color: white; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-weight: 900; font-size: 0.7rem; }
        
        .tabs { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .tab { padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; background: #f1f5f9; cursor: pointer; font-weight: 700; text-align: center; }
        .tab.active { border-color: var(--secondary); background: #eff6ff; color: var(--secondary); }

        .section-title { font-weight: 800; font-size: 0.7rem; color: #64748b; text-transform: uppercase; margin: 15px 0 8px; border-bottom: 1px solid #f1f5f9; padding-bottom: 4px; }
        .grid-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-bottom: 10px; }
        .input-box { display: flex; flex-direction: column; gap: 4px; }
        label { font-size: 0.7rem; font-weight: 700; color: #475569; }
        select, input { padding: 8px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 0.9rem; outline: none; }

        .booster-zone { background: #fffbeb; border: 1px solid #fde68a; padding: 12px; border-radius: 10px; display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 8px; margin-bottom: 10px; }
        .other-zone { background: #f0f9ff; border: 1px solid #bae6fd; padding: 12px; border-radius: 10px; display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 8px; }
        .check-item { display: flex; align-items: center; gap: 6px; font-size: 0.8rem; cursor: pointer; font-weight: 600; }

        .pts-panel { background: var(--primary); color: white; padding: 20px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin: 20px 0; border-left: 6px solid var(--secondary); }
        .pts-val { font-size: 2.5rem; font-weight: 900; color: #60a5fa; }
        
        .btn-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .btn { padding: 15px; border: none; border-radius: 10px; font-weight: 800; cursor: pointer; font-size: 1rem; }
        .btn-save { background: var(--accent); color: white; }
        .btn-dl { background: #334155; color: white; }

        .log-item { background: #fff; border: 1px solid #e2e8f0; padding: 10px; border-radius: 8px; margin-bottom: 6px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

<div class="container">
    <div class="match-setup">
        <div class="team-cfg"><label>Team 1</label><input type="text" id="t1_code" value="GOAT" oninput="updFN()"></div>
        <div class="vs-badge">VS</div>
        <div class="team-cfg"><label>Team 2</label><input type="text" id="t2_code" value="PLK" oninput="updFN()"></div>
    </div>

    <div class="tabs">
        <div class="tab active" id="tab1" onclick="setTeam(1)">TEAM 1</div>
        <div class="tab" id="tab2" onclick="setTeam(2)">TEAM 2</div>
    </div>

    <div class="grid-row">
        <div class="input-box"><label>Country</label><select id="country" onchange="loadP()"><option value="">-- Country --</option></select></div>
        <div class="input-box"><label>Player</label><select id="player" onchange="calc()"></select></div>
        <div class="input-box"><label>Role</label><select id="role" onchange="calc()">
            <option value="bat">Batsman/WK/AR</option>
            <option value="bowl">Pure Bowler</option>
        </select></div>
    </div>

    <div class="section-title">Special Boosters ðŸš€</div>
    <div class="booster-zone">
        <label class="check-item"><input type="checkbox" id="b_2x"> 2x Score</label>
        <label class="check-item"><input type="checkbox" id="b_mega"> Megalomaniac</label>
        <label class="check-item"><input type="checkbox" id="b_vacc"> Vaccinate</label>
        <label class="check-item" style="color:var(--danger)"><input type="checkbox" id="b_rev"> REVERSE</label>
        <label class="check-item"><input type="checkbox" id="b_comp"> Companion</label>
        <label class="check-item"><input type="checkbox" id="b_shad"> Shadow</label>
    </div>

    <div class="section-title">Batting</div>
    <div class="grid-row">
        <div class="input-box"><label>Runs</label><input type="number" id="runs" value="0"></div>
        <div class="input-box"><label>Balls</label><input type="number" id="balls" value="0"></div>
        <div class="input-box"><label>Fours</label><input type="number" id="fours" value="0"></div>
        <div class="input-box"><label>Sixes</label><input type="number" id="sixes" value="0"></div>
        <label class="check-item"><input type="checkbox" id="isOut"> Got Out</label>
        <label class="check-item"><input type="checkbox" id="duckEx"> Last Over Duck</label>
    </div>

    <div class="section-title">Bowling</div>
    <div class="grid-row">
        <div class="input-box"><label>Wkts (C/S)</label><input type="number" id="wk_cs" value="0"></div>
        <div class="input-box"><label>Wkts (B/LBW/HW)</label><input type="number" id="wk_lb" value="0"></div>
        <div class="input-box"><label>Maidens</label><input type="number" id="maidens" value="0"></div>
        <div class="input-box"><label>Overs</label><input type="number" id="overs" step="0.1" value="0"></div>
        <div class="input-box"><label>Runs Conc.</label><input type="number" id="rc" value="0"></div>
        <div class="input-box"><label>Dots</label><input type="number" id="dots" value="0"></div>
    </div>
    <div class="grid-row">
        <label class="check-item"><input type="checkbox" id="hattrick"> Hattrick (+100)</label>
        <label class="check-item"><input type="checkbox" id="t2t"> 2 in 2 Balls (+25)</label>
    </div>

    <div class="section-title">Fielding</div>
    <div class="grid-row">
        <div class="input-box"><label>Catches</label><input type="number" id="f_catch" value="0"></div>
        <div class="input-box"><label>Stumpings</label><input type="number" id="f_stump" value="0"></div>
        <div class="input-box"><label>RunOut (Direct)</label><input type="number" id="f_rod" value="0"></div>
        <div class="input-box"><label>RunOut (Involved)</label><input type="number" id="f_roi" value="0"></div>
    </div>

    <div class="section-title">Other Points</div>
    <div class="other-zone">
        <label class="check-item"><input type="checkbox" id="o_xi" checked> Playing XI (+5)</label>
        <label class="check-item"><input type="checkbox" id="o_win"> Match Win (+10)</label>
        <label class="check-item" style="color:var(--danger)"><input type="checkbox" id="o_loss"> Match Loss (-5)</label>
        <label class="check-item"><input type="checkbox" id="o_mom"> MOM (+50)</label>
        <label class="check-item"><input type="checkbox" id="o_ocap"> Orange Cap (+150)</label>
        <label class="check-item"><input type="checkbox" id="o_pcap"> Purple Cap (+150)</label>
        <label class="check-item"><input type="checkbox" id="o_emg"> Emerging (+75)</label>
        <label class="check-item"><input type="checkbox" id="o_m6"> Most 6s (+100)</label>
        <label class="check-item"><input type="checkbox" id="o_m4"> Most 4s (+100)</label>
        <label class="check-item"><input type="checkbox" id="o_pot"> POT (+200)</label>
    </div>

    <div class="pts-panel">
        <div><strong id="p_disp" style="font-size:1.2rem">...</strong></div>
        <div class="pts-val" id="total_pts">0</div>
    </div>

    <div class="btn-row">
        <button class="btn btn-save" onclick="save()">SAVE PLAYER</button>
        <button class="btn btn-dl" onclick="download()">DOWNLOAD JSON <span id="fn_txt">STATS.json</span></button>
    </div>

    <div id="log" style="margin-top:20px"></div>
</div>

<script>
const players = {
    "India": ["Abhishek Sharma", "Rinku Singh", "Jasprit Bumrah", "Sanju Samson", "Kuldeep Yadav", "Suryakumar Yadav", "Ishan Kishan", "Hardik Pandya", "Axar Patel", "Tilak Varma", "Arshdeep Singh", "Varun Chakravarthy", "Shivam Dube", "Mohammed Siraj"],
    "Afghanistan": ["Rahmanullah Gurbaz", "Mohammed Nabi", "Mujeeb Ur Rehman", "Ibrahim Zadran", "Sediqullah Atal", "Darwish Rasooli", "Rashid Khan", "Noor Ahmed", "Gulbadin Naib", "Fazalhaq Farooqi"],
    "South Africa": ["Anrich Nortje", "Tristan Stubbs", "Quinton de Kock", "Keshav Maharaj", "Dewald Brevis", "Marco Jansen", "George Linde", "David Miller", "Lungi Ngidi", "Corbin Bosch", "Ryan Rickelton", "Kagiso Rabada"],
    "Australia": ["Adam Zampa", "Cooper Connolly", "Nathan Ellis", "Travis Head", "Marcus Stoinis", "Josh Inglis", "Mitchell Marsh", "Xavier Bartlett", "Josh Hazlewood", "Tim David", "Glenn Maxwell", "Matthew Kunhemann", "Ben Dwarshuis", "Matt Renshaw"],
    "New Zealand": ["Ish Sodhi", "Rachin Ravindra", "Daryl Mitchell", "Finn Allen", "Jacob Duffy", "Mark Chapman", "Glenn Phillips", "Kyle Jamieson", "Michael Bracewell", "Tim Seifert", "Mitchell Santner", "Neesham", "Mat Henry"],
    "Sri Lanka": ["Maheesh Theekshana", "Kushal Perera", "Kushal Mendis", "Dunith Wellalage", "Matheesha Pathirana", "Dushmantha Chameera", "Kamil Mishara", "Pathum Nissanka", "Dasun Shanaka", "Kamindu Mendis"],
    "Pakistan": ["Shadab Khan", "Shaheen Shah Afridi", "Said Ayub", "Babar Azam", "Naseem Shah", "Muhammed Nawaz", "Faheem Ashraf", "Fakhar Zaman", "Salman Agha", "Usman Khan", "Shahibzada Farhan", "Abrar Ahmed"],
    "England": ["Jofra Archer", "Adil Rashid", "Will Jacks", "Luke Wood", "Harry Brook", "Jacob Bethell", "Jos Buttler", "Sam Curran", "Tom Banton", "Phil Salt"],
    "West Indies": ["Shefone Rutherford", "Jason Holder", "Gudakesh Motie", "Roston Chase", "Rovman Powell", "Shai Hope", "Brandon King", "Mathew Forde", "Johnson Charles", "Jayden Seales", "Shimron Hetmyer", "Romario Shepherd", "Akeal Hosein"],
    "Others": ["Paul Stirling", "Sikandar Raza", "JJ Smuts", "Monank Patel", "Aasif Sheikh", "Logan van Beek", "Scott Edwards", "Andre Gous"]
};

let activeTeam = 1;
let savedData = [];
let teamCountries = {1: "", 2: ""};

function init() {
    const cSel = document.getElementById('country');
    Object.keys(players).sort().forEach(c => cSel.innerHTML += `<option value="${c}">${c}</option>`);
    updFN();
}

function setTeam(id) {
    activeTeam = id;
    document.getElementById('tab1').className = (id===1) ? 'tab active' : 'tab';
    document.getElementById('tab2').className = (id===2) ? 'tab active' : 'tab';
    document.getElementById('country').value = teamCountries[id];
    loadP();
}

function loadP() {
    const c = document.getElementById('country').value;
    teamCountries[activeTeam] = c;
    const pSel = document.getElementById('player');
    pSel.innerHTML = '<option value="">-- Select Player --</option>';
    if(players[c]) players[c].sort().forEach(p => pSel.innerHTML += `<option value="${p}">${p}</option>`);
}

function calc() {
    let p = 0;
    const role = document.getElementById('role').value;
    
    // --- Batting ---
    const runs = parseInt(document.getElementById('runs').value) || 0;
    const balls = parseInt(document.getElementById('balls').value) || 0;
    const fours = parseInt(document.getElementById('fours').value) || 0;
    const sixes = parseInt(document.getElementById('sixes').value) || 0;
    const isOut = document.getElementById('isOut').checked;

    p += (runs * 1) + (fours * 1) + (sixes * 3);
    
    // Duck (No negatives for bowlers)
    if(runs === 0 && isOut && role === 'bat' && !document.getElementById('duckEx').checked) {
        p -= 10;
    }

    // SR (Min 10 balls or 20 runs)
    if((balls >= 10 || runs >= 20) && role === 'bat') {
        const sr = (runs / balls) * 100;
        if(sr <= 50) p -= 30;
        else if(sr <= 75) p -= 20;
        else if(sr <= 100) p -= 10;
        else if(sr > 200) {
            let base = 20;
            let extras = Math.floor((sr - 200) / 25) * 5;
            p += (base + extras);
        }
        else if(sr > 175) p += 20;
        else if(sr > 150) p += 15;
        else if(sr > 135) p += 10;
        else if(sr > 120) p += 5;
    }

    // Batting Milestones
    if(runs >= 150) p += 40;
    else if(runs >= 125) p += 25;
    else if(runs >= 100) p += 20;
    else if(runs >= 75) p += 15;
    else if(runs >= 50) p += 10;
    else if(runs >= 30) p += 5;

    // Unbeaten (30+ balls)
    if(!isOut && balls >= 30) p += 10;

    // --- Bowling ---
    const wk_cs = parseInt(document.getElementById('wk_cs').value) || 0;
    const wk_lb = parseInt(document.getElementById('wk_lb').value) || 0;
    const tw = wk_cs + wk_lb;
    
    p += (wk_cs * 25); 
    p += (wk_lb * 33); // Corrected: 25 (base) + 8 (bonus) = 33
    
    p += (parseInt(document.getElementById('maidens').value) || 0) * 25;
    p += (parseInt(document.getElementById('dots').value) || 0) * 1;

    // Economy Rate (Min 12 balls/2 overs)
    const overs = parseFloat(document.getElementById('overs').value) || 0;
    const rc = parseInt(document.getElementById('rc').value) || 0;
    if(overs >= 2) {
        const eco = rc / overs;
        if(eco <= 1.0) p += 70;
        else if(eco <= 2.0) p += 60;
        else if(eco <= 3.0) p += 50;
        else if(eco <= 4.0) p += 40;
        else if(eco <= 5.0) p += 30;
        else if(eco <= 6.0) p += 20;
        else if(eco <= 7.0) p += 10;
        else if(eco > 14.0) p -= 20;
        else if(eco > 12.0) p -= 15;
        else if(eco > 11.0) p -= 10;
        else if(eco > 10.0) p -= 5;
    }

    // Bowling Milestones
    if(tw >= 7) p += 50;
    else if(tw >= 6) p += 40;
    else if(tw >= 5) p += 30;
    else if(tw >= 4) p += 20;
    else if(tw >= 3) p += 10;

    if(document.getElementById('hattrick').checked) p += 100;
    if(document.getElementById('t2t').checked) p += 25;

    // --- Fielding ---
    const fc = parseInt(document.getElementById('f_catch').value) || 0;
    const fs = parseInt(document.getElementById('f_stump').value) || 0;
    const frd = parseInt(document.getElementById('f_rod').value) || 0;
    const fri = parseInt(document.getElementById('f_roi').value) || 0;
    
    p += (fc * 10) + (fs * 15) + (frd * 25) + (fri * 10);
    if((fc + fs + frd + fri) >= 3) p += 30;

    // --- Other ---
    if(document.getElementById('o_xi').checked) p += 5;
    if(document.getElementById('o_win').checked) p += 10;
    if(document.getElementById('o_loss').checked) p -= 5;
    if(document.getElementById('o_mom').checked) p += 50;
    if(document.getElementById('o_ocap').checked) p += 150;
    if(document.getElementById('o_pcap').checked) p += 150;
    if(document.getElementById('o_emg').checked) p += 75;
    if(document.getElementById('o_m6').checked) p += 100;
    if(document.getElementById('o_m4').checked) p += 100;
    if(document.getElementById('o_pot').checked) p += 200;

    // --- Boosters ---
    if(document.getElementById('b_mega').checked) {
        p += (parseInt(document.getElementById('dots').value) || 0) * 10;
        p += (fours + sixes) * 10;
    }
    if(document.getElementById('b_2x').checked) p *= 2;
    if(document.getElementById('b_vacc').checked && p < 0) p = 0;
    if(document.getElementById('b_rev').checked) p = 0;

    document.getElementById('total_pts').innerText = Math.round(p);
    document.getElementById('p_disp').innerText = document.getElementById('player').value || "...";
    return Math.round(p);
}

function save() {
    const name = document.getElementById('player').value;
    if(!name) return;
    const pts = calc();
    const team = document.getElementById(`t${activeTeam}_code`).value;

    savedData.push({
        name, team, pts,
        timestamp: new Date().toLocaleTimeString(),
        summary: {
            bat: document.getElementById('runs').value + "(" + document.getElementById('balls').value + ")",
            wkts: parseInt(document.getElementById('wk_cs').value) + parseInt(document.getElementById('wk_lb').value)
        }
    });

    const div = document.createElement('div');
    div.className = 'log-item';
    div.innerHTML = `<div><strong>${name}</strong> (${team})</div> <strong>${pts} pts</strong>`;
    document.getElementById('log').prepend(div);
    document.getElementById('count').innerText = savedData.length;
}

function updFN() {
    const t1 = document.getElementById('t1_code').value.toUpperCase();
    const t2 = document.getElementById('t2_code').value.toUpperCase();
    document.getElementById('fn_txt').innerText = `${t1}vs${t2}_FINAL.json`;
}

function download() {
    const blob = new Blob([JSON.stringify(savedData, null, 2)], { type: 'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = document.getElementById('fn_txt').innerText;
    a.click();
}

document.querySelectorAll('input, select').forEach(el => el.oninput = calc);
init();
</script>
</body>
</html>

